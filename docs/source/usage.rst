=======================
How to use auto-kappa
=======================

Examples
=========

1. Example for auto-kappa

The ``.../examples/5_single`` directory contains an example to compute thermal conductivity of Silicon.
While the ``run.sh`` script can be used to run this calculation, it is recommended to use a job scheduler to run this example.
An example job script is shown below. Please modify it according to your environment.

.. code-block:: shell
    
    #!/bin/sh
    #PBS -q default
    #PBS -l nodes=1:ppn=24  ## Only single node calculation is available
    #PBS -j oe
    #PBS -N test            ## job name
    
    export LANG=C
    export OMP_NUM_THREADS=1  ## Please set OMP_NUM_THREADS=1
    cd $PBS_O_WORKDIR

    nprocs=24               ## Number of processes

    mpid=mp-149
    dir_db=${directory_of_downloaded_phoonondb}/${mpid}  ## This line must be modified.
    
    if [ ! -e $dir_db ]; then
        echo " Cannot find $dir_db"    
        exit
    fi
    
    akrun \
        --directory $dir_db \
        --outdir $mpid \
        --nprocs $nprocs

.. .. _sec-automation:

.. Automation Calculation
.. =======================

.. Scripts in ``examples/5_single`` and ``examples/massive`` may be useful to run the automation calculation.
.. First, data of PhononDB need to be downloaded

.. 1. Download data from PhononDB

.. .. code-block:: shell
    
..     cd (arbitrary directory in which Phonondb will be downloaded.)
..     cp .../examples/phonondb/* ./
    
..     ## modify "imin" and "imax" in get_phonondb.sh
..     vi get_phonondb.sh
..     sh get_phonondb.sh


.. 2. Start the calculation

.. .. code-block:: shell
    
..     dir="APDB_0-10000"
..     mkdir $dir
..     cd $dir
..     cp .../auto-kappa/examples/massive/run_massive.sh ./
..     ## modify the script and submit jobs


.. Known Bugs
.. ==========

.. POTCAR file
.. ------------

.. * You may get warning like below. While these messages will be removed, you can ignore them which do not affect the 
..   calculation. These messages are shown because POTCAR files are generated by ASE, which addes a few information in the POTCAR 
..   file, and these files are read by Pymatgen, which consideres that the additional information may be error.

.. .. code-block:: shell

..     .../lib/python3.8/site-packages/pymatgen/io/vasp/inputs.py:1738: UserWarning: Ignoring unknown variable type SHA256 
..     warnings.warn(f"Ignoring unknown variable type {key}")
..     .../lib/python3.8/site-packages/pymatgen/io/vasp/inputs.py:1738: UserWarning: Ignoring unknown variable type COPYR
..     warnings.warn(f"Ignoring unknown variable type {key}")


