=======================
How to Use Auto-kappa
=======================

Examples
=========

1. ``database`` example

The calculation in ``database`` calculates thermal conductivity of Silicon automatically.
Because every process is included in this job, it takes one or two hours.
It is recommended to use a job scheduler to submit this job.
An example of job script is shown below. Please modify depending on your environment.

.. code-block:: shell
    
    #!/bin/sh
    #PBS -q default         ## name of queue that you can check with a command like "qstat -q".
    #PBS -l nodes=1:ppn=24  ## only nodes=1 is available
    #PBS -j oe
    #PBS -N test            ## job name
    
    export LANG=C
    export OMP_NUM_THREADS=1  ## Please set OMP_NUM_THREADS=1
    cd $PBS_O_WORKDIR
    
    ncores=24               ## ncores must be smaller than ppn, which is set above.
    
    mpid=mp-149             ## Si
    dir_db=${directory_of_downloaded_phoonondb}/${mpid}  ## This line must be modified.
    
    if [ ! -e $dir_db ]; then
        echo " Cannot find $dir_db"    
        exit
    fi
    
    akrun \
        --directory $dir_db \
        --material_name $mpid \
        --ncores $ncores

.. _sec-automation:

Automation Calculation
=======================

Scripts in ``examples/phonondb`` and ``examples/massive`` may be useful to run the automation calculation.
First, data of Phonondb need to be downloaded

1. Download data from Phonondb

.. code-block:: shell
    
    $ cd (arbitrary directory in which Phonondb will be downloaded.)
    $ cp .../examples/phonondb/* ./
    
    ## modify "imin" and "imax" in get_phonondb.sh
    $ vi get_phonondb.sh
    $ sh get_phonondb.sh


2. Start the calculation

.. code-block:: shell
    
    $ dir="APDB_0-10000"
    $ mkdir $dir
    $ cd $dir
    $ cp .../auto-kappa/examples/massive/run_massive.sh ./
    ## modify the script and submit jobs


Known Bugs
==========

POTCAR file
------------

* You may get warning like below. While these messages will be removed, you can neglect them which do not affect the 
  calculation. These messages are shown because POTCAR files are generated by ASE, which addes a few information in the POTCAR 
  file, and these files are read by Pymatgen, which consideres that the additional information may be error.

.. code-block:: shell

    .../lib/python3.8/site-packages/pymatgen/io/vasp/inputs.py:1738: UserWarning: Ignoring unknown variable type SHA256 
    warnings.warn(f"Ignoring unknown variable type {key}")
    .../lib/python3.8/site-packages/pymatgen/io/vasp/inputs.py:1738: UserWarning: Ignoring unknown variable type COPYR
    warnings.warn(f"Ignoring unknown variable type {key}")


